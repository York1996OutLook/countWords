Attention-aware Multi-stroke Style Transfer

Yuan Yao1, Jianqiang Ren2, Xuansong Xie2, Weidong Liu1, Yong-Jin Liu1, Jun Wang3

1Tsinghua University,

2Alibaba Group,

3University College London

Abstract

Neural style transfer has drawn considerable attention
from both academic and industrial Ô¨Åeld. Although visual
effect and efÔ¨Åciency have been signiÔ¨Åcantly improved, ex-
isting methods are unable to coordinate spatial distribution
of visual attention between the content image and stylized
image, or render diverse level of detail via different brush
strokes. In this paper, we tackle these limitations by devel-
oping an attention-aware multi-stroke style transfer model.
We Ô¨Årst propose to assemble self-attention mechanism into a
style-agnostic reconstruction autoencoder framework, from
which the attention map of a content image can be derived.
By performing multi-scale style swap on content features
and style features, we produce multiple feature maps re-
Ô¨Çecting different stroke patterns. A Ô¨Çexible fusion strategy is
further presented to incorporate the salient characteristics
from the attention map, which allows integrating multiple
stroke patterns into different spatial regions of the output
image harmoniously. We demonstrate the effectiveness of
our method, as well as generate comparable stylized im-
ages with multiple stroke patterns against the state-of-the-
art methods.

1. Introduction

Style transfer is a powerful technique for art creation and
image editing that enables recomposing the images in the
style of other images. Recently, inspired by the power of
Convolutional Neural Network (CNN) in visual perception
tasks, Gatys et al. [4, 5] opens up a new Ô¨Åeld named Neural
Style Transfer, which Ô¨Årst introduces neural representations
to separate and recombine content and style of arbitrary im-
ages. They propose to extract the content features and style
correlations (Gram matrix) along the processing hierarchy
of a pretrained network classiÔ¨Åer. Based on this work, sev-
eral algorithms have been proposed to accelerate the devel-
opment in terms of the generalization and efÔ¨Åciency issues,
through optimization-based methods [5, 14, 19] and feed-
forward networks [10, 12, 23]. The success of style transfer
makes it possible to deploy service upon mobile applica-
tions (e.g., Prisma, Artify), allowing users to create an art-

Content & Style

Style-Swap

AdaIN

WCT

Avatar-Net

StrokePyramid

Attention Map

Our Result

Figure 1. Existing methods are unable to coordinate spatial dis-
tribution of visual attention between content image and stylized
image, misleading the stylized rendering on diverse content re-
gions in an indiscriminate way, resulting in insufÔ¨Åcient styliza-
tion (Style-Swap), unexpected patterns (AdaIN, StrokePyramid)
or distorted attention regions (WCT, Avatar-Net). Due to atten-
tion mechanism and multi-stroke fusion strategy, our method can
achieve faithful transfer of style and attention consistency with
content image simultaneously.

work out of a picture they took with their phones.

In spite of signiÔ¨Åcant progress already achieved, these
methods suffer from the restricted binding between the
model and speciÔ¨Åc styles. Recently, Arbitrary-Style-Per-
Model Fast Style Transfer Methods (ASPM) [9] are pro-
posed to conquer this dilemma. One possible solution is to
coordinate high-level statistical distribution between con-
tent features and style features. Although visual quality and
efÔ¨Åciency can be greatly improved, they unexpectedly intro-
duce unexpected or distorted patterns to the stylized result
because of treating diverse image regions in an indiscrim-
inate way, such as AdaIN [7] and WCT [13] in Figure 1.
Another solution is to swap the content feature patch with
the closest style feature patch at the intermediate layer of
a trained autoencoder. However, this method may gener-
ate insufÔ¨Åcient stylized results when huge difference ex-
ists between content and style images, such as the Style-
Swap [2] method shown in Figure 1. Compared with Style-
Swap, Avatar-Net [21] further dispels the domain gap be-
tween content and style features, leading to better stylized
results, but it still maintains inconsistent spatial distribution

1467

of visual attention with the content image and thus mani-
fests distortion in terms of semantic perception.

Stroke textons [33], which are referred to fundamental
micro-structures in natural images, reÔ¨Çect perceptual style
patterns. Methods such as [8, 25] are dedicated to learn
stroke control in transfer process. Jing et al. [8] Ô¨Årst pro-
poses to achieve continuous stroke size control by incorpo-
rating multiple stroke sizes into one single StrokePyramid
model. The StrokePyramid result shown in Figure 1 is pro-
duced by mixing two different stroke sizes. However, due to
the lack of local awareness of content image, they perform
the stroke interpolation in a holistic way regardless of region
diversity, leading to lacking of level of details. In addition,
these methods are inÔ¨Çexible to handle arbitrary styles in one
feedforward pass.

To address the aforementioned problems, we propose an
attention-aware multi-stroke (AAMS) model for arbitrary
styles transfer. Our model encourages attention consistency
(which refers to spatial consistency of visual attention dis-
tribution) for corresponding regions between content im-
age and stylized image, and it achieves both scalable multi-
stroke fusion control and automatic spatial stroke size con-
trol in one shot. SpeciÔ¨Åcally, we introduce self-attention
mechanism as complementary to the autoencoder frame-
work. The self-attention module calculates the response at
a position as a weighted sum of the features at all positions,
which helps to capture long-range dependencies across im-
age regions. By performing a reconstruction training pro-
cess for the self-attention assembled autoencoder, the at-
tention map could grasp salient characteristics within any
content images. As shown in Figure 1, the attention map
of the content image highlights the salient parts while en-
abling consistency of the attention degree for long-range
features. Based on the correlation between receptive Ô¨Åeld
and stroke size, a multi-scale style swap module is proposed
to blend distinct stroke patterns via swapping the content
features with multi-scale style features in high-level repre-
sentations. We inject the attention map into a multi-stroke
fusion module to synthesize distinct stroke patterns harmo-
niously, which achieves automatic spatial stroke size con-
trol. Comprehensive experiments have been conducted to
demonstrate the effectiveness of our method, and the model
is capable of generating comparable stylized images with
multiple stroke patterns against the state-of-the-art methods.
The main contributions of this work are:

‚Ä¢ We introduce self-attention mechanism to an autoen-
coder network, allowing capturing critical characteris-
tics and long-range region relations of the input image.

‚Ä¢ We propose multi-scale style swap to break the limita-
tion of Ô¨Åxed receptive Ô¨Åeld in high-level feature space
and produce multiple feature maps reÔ¨Çecting different
stroke patterns.

‚Ä¢ By combining with attention map, we present a Ô¨Çexi-
ble fusion strategy to integrate multiple stroke patterns
into different spatial regions of the output image har-
moniously, which enables the attention consistency be-
tween the content image and stylized image.

2. Related Work

Neural Style Transfer. Arbitrary-Style-Per-Model meth-
ods (ASPM) [9] have recently been proposed to transfer ar-
bitrary styles through only one single model. The backend
idea is to formulate the style transfer as an image recon-
struction process, with feature statistics fusion between con-
tent and style features at intermediate layers. Chen et al. [2]
Ô¨Årst proposes to swap the content feature patch with the best
matching style feature patch using a Style-Swap operation.
Huang et al. [7] introduces adaptive instance normalization
(AdaIN) to adjust the mean and variance of the content fea-
ture to match those of the style feature. Li et al. [13] per-
forms the style transfer by integrating the whitening and
coloring transforms (WCT) to match the statistical distribu-
tions and correlations between the features of content and
style. Avatar-Net [21] elevates the feature transfer ability
by matching the normalized counterparts features and ap-
plying a patch-based style decorator. However, the above
methods either locally exchange the closest feature patches
or transfer feature statistics globally, which tends to display
a uniform stroke pattern without attention aware guaranty.
In comparison, our methods perform style transfer to ren-
der visually plausible result with multi-stroke patterns in-
tegrated within the same stylized image. Another related
work is [8], which proposes a StrokePyramid module to
incorporate multiple stroke sizes into one single model, it
empowers distinct stroke sizes in different spatial regions
within the same transformed image. Our approach can au-
tomatically manipulate multiple stroke fusion through the
guidance of attention feature in one shot within ASPM
framework, while [8] achieves spatial stroke size control by
feeding masked content image and need to be retrained for
each new style.
Attention Models. One of the most promising trends in
research is the emergence of incorporating attention mech-
anism into deep learning framework [11, 17]. Rather than
compressing an entire image or a sequence into a static rep-
resentation, attention allows the model to focus on the most
relevant part of images or features as needed. Such mecha-
nism has been proved to be very effective in many vision
tasks including image classiÔ¨Åcation [26, 32], image cap-
tioning [28, 30] and visual question answering [27, 29]. In
particular, self-attention [16, 24] has been proposed to cal-
culate the response at a position in a sequence by attending
to all positions within the same sequence. Shaw et al. [20]
proposes to incorporate relative position information for se-

1468

I

c

I

s

‚Ñí$%&

Relu_4_1

fc

Self-Attention

Module

A
c

‚Ñí‚Äô""

Attention Filter

ÀÜA

c

Multi-stroke

Fusion

fcs

S
t
y
l
e
E
n
h
a
n
c
e
m
e
n
t

S
t
y
l
e

E
n
h
a
n
c
e
m
e
n
t

S

t
y
l
e
E
n
h
a
n
c
e
m
e
n
t

‚Ñí"#

I

o

Relu_4_1

fs

Relu_3_1

Multi-scale
Style Swap

Relu_2_1

Relu_1_1

ÀÜf

0

cs

c(
f

)

‚Ä¶
ÀÜfcs

K

Figure 2. An overview of our network architecture. We train a self-attention autoencoder for image reconstruction in a style-agnostic
manner. Given a content image Ic and a style image Is in the testing phase, we perform multi-stroke style transfer via style swap and
fusion modules under the guidance of attention map ÀÜAc. Skip connections are introduced to enhance the stylization effects during the
reconstruction process. The black and green lines represent the training and testing phases respectively, while the orange dotted line
denotes the Ô¨Çow of our loss functions.

quences in the self-attention mechanism of the Transformer
model, which improves the translation quality on machine
translation tasks. Zhang et al. [31] demonstrates that the
self-attention model can capture the multi-level dependen-
cies across image regions and draw Ô¨Åne details in the con-
text of GAN framework. Compared with [31], we adapt the
self-attention to introduce a residual feature map to catch
salient characteristics within content images.

3. Proposed Approach

For the task of style transfer, the goal is to generate a styl-
ized image Io, given the content image Ic and style image
Is. To satisfy arbitrary style transfer in one feed-forward
pass while integrating images with multiple stroke patterns,
we develop three modules( multi-scale style swap, multi-
stroke fusion and self-attention module) in the bottleneck
layer for feature manipulation. The three modules cooper-
ate with each other and form a coupling framework. The
network architecture of our proposed approach is depicted
in Figure 2.

Assume that fc and fs denote the feature maps extracted
from the encoder correspond to Ic and Is respectively. At
the core of our network, a self-attention module is proposed
to learn the saliency properties by feeding with fc, which
will generate self-attention feature map Ac for any content
Ic after reconstruction training process. During the interme-
diate process of transferring fc into the domain of fs via a
WCT transformation in the testing phase, a multi-scale style
swap module is Ô¨Årst designed to synthesize features of mul-
tiple stroke sizes ÀÜf k
cs(k = 1, . . . , K), taking both the con-

tent feature fc and style features fs as input. The module
conducts a style-swap procedure for the content feature and
K style features simultaneously. To perform a Ô¨Çexible inte-
gration of the features, a multi-stroke fusion module is pre-
sented to handle controllable blending. The attention map
ÀÜAc Ô¨Åltered from Ac is incorporated to guide fusion among
the content feature fc( ÀÜf 0
cs) and the K swapped stroke fea-
tures ÀÜf k
cs(k = 1, . . . , K), where K is the user provided clus-
tering number. After the two steps, the synthetic feature fcs
is fed into the trained decoder to generate the stylized im-
age Io in one feed-forward pass. We further introduce skip
connections to enhance the stylization effects by adapting
multiple level of synthetic features with style features. In
this section, we introduce the three components in details.

3.1. Self Attention Autoencoder

We employ a self-attention mechanism [31] to catch the
relationships between separated spatial regions. In detail,
let Œ¶e(¬∑) and Œ¶d(¬∑) represent the encoder and decoder re-
spectively. The encoder produces fx = Œ¶e(x) ‚àà RH√óW √óC
by mapping the input image x into the intermediate activa-
tion space, with H, W, C denoting height, width and channel
number respectively.

Let f lat(¬∑) denote the Ô¨Çatten operation along the channel
dimension. We calculate the self-attention feature of fx in
the ith location as:

Ai

x =

HW

X

j=1

Œ±ij ‚àó f lat(fx ‚äó Œòh)j ,

(1)

where ‚äó denotes the convolution operation and Œ±ij is the

1469

weight coefÔ¨Åcient. Œ±ij indicates the dependencies between
two regions, not just for neighboring positions. It is com-
puted using a softmax function:

Œ±ij =

exp(eij)
k=1 exp(eik)

PHW

,

(2)

where e is obtained by a compatibility function that com-
pares elements by a scaled dot product:

e = f lat(fx ‚äó Œòu) ‚àó f lat(fx ‚äó Œòg)T ,

(3)

The self-attention feature map decoded from the
self-attention module is Ax = (a1
x )T ‚àà
RN √óC, N = HW , which will be reshaped as the same di-
mensions of fx. In the above formulation, Œòh, Œòu, Œòg ‚àà
RC√ó ÀÜC are learned parameter matrices within our self-
attention autoencoder framework. We implement them as
1 √ó 1 convolution [31].

x, . . . , aN

x, a2

Given the self-attention feature map Ax, we propose to
obtain a self-attention residual Rx by multiplying the hid-
den feature map fx with Ax. The output is then given by
appending the residual to the feature map fx.

Ox = Rx + fx = Ax ‚äô fx + fx ,

(4)

where ‚äô denotes the element-wise multiplication operator.
We then feed Ox into the decoder and reconstruct the input
image ÀÜx = Œ¶d(Ox). In this manner, the degree of variance
on each spatial position can be revealed by Rx, exhibiting
the salient regions in synthesizing the image.

Similar to [10, 13, 21], we deÔ¨Åne the semantic content
loss as the sum of perceptual loss and pixel reconstruction
loss to generate visually indistinguishable images with the
input images:

Lcon = X

||œÜl(ÀÜx) ‚àí œÜl(x)||2

2 + Œªp||ÀÜx ‚àí x||2
2 ,

(5)

l‚ààlc

where œÜl(x) is the activations of the lth layer of the pre-
trained VGG-19 network when processing image x, Œªp is
the weight to balance the two losses. Both losses are calcu-
lated using normalized Euclidean distance. In addition, we
introduce a sparse loss on self-attention feature map Ax to
encourage the self-attention autoencoder to pay more atten-
tion to small regions instead of the whole image:

Latt = ||Ax||1 .

(6)

With total variational regularization loss Ltv [10] added
to encourage the spatial smoothness in the generated im-
ages, we obtain our total loss function as:

L = ŒªconLcon + ŒªattLatt + ŒªtvLtv ,

(7)

where Œªcon, Œªatt and Œªtv are the balancing factors.

Content

SA feature map

Absolute

Gaussian Smoothing

Figure 3. Attention Ô¨Ålter conducts Absolute and Gaussian smooth-
ing transformation upon the self-attention feature map, the gener-
ated attention map can exhibit evident saliency distribution.

3.2. Multi scale Style Swap

Style swap is the process of substituting content feature
with the closest style feature patch-by-patch [2]. Given a
speciÔ¨Åc patch size, the style swap procedure can be im-
plemented efÔ¨Åciently as two convolutions operations and a
channel-wise argmax operation. The Ô¨Ålters of the convolu-
tional layers are derived from the extracted style patches.
Based on the analysis of how receptive Ô¨Åeld inÔ¨Çuences
stroke size in [8], we note that larger patch size leads to
larger receptive Ô¨Åeld and style stroke accordingly. However,
the increase of the scale for patch size is strictly limited by
the network structure and easily saturated when the patch
size is larger than the Ô¨Åxed receptive Ô¨Åeld of network.

To resolve the above issue in an efÔ¨Åcient manner, we
propose to Ô¨Åx the patch size while changing the scale of
activation feature map of styles, such that we introduce
multi-scale stroke patterns after swapping with the same
content feature. SpeciÔ¨Åcally, we Ô¨Årst adopt whitening trans-
form [13] on content feature fc and style feature fs to peel
off their style information while preserving global structure,
results are denoted as ÀÜfc and ÀÜfs. We then obtain a series of
multi-scale style features by casting the whitened style fea-
ture into multiple scales:

ÀÜf k
s = TŒ≤k ( ÀÜfs) ,

(8)

denotes

where T
the scaling operation, Œ≤k(k =
1, 2, . . . , K) is the scale coefÔ¨Åcient controlling different
stroke sizes. Finally, the multiple swapped features are pro-
duced by performing style-swap procedure between ÀÜfc and
multiple ÀÜf k

s simultaneously.

ÀÜf k
cs = Fss( ÀÜfc, ÀÜf k

s ) ,

(9)

where Fss denotes the parallelizable style swap process [2].

3.3. Multi stroke Fusion

Equipped with self-attention mechanism, the residual Rc
in eq. (4) is able to capture critical characteristics and long-
range region correlations of the feature map fc. In detail,
during the reconstruction process, the residual learns to Ô¨Åne
tune intrinsically crucial parts of content feature by adding
variation to it, therefore the non-trivial (zero) parts of the
residual deserve special attention. We utilize an attention
Ô¨Ålter by Ô¨Årst performing an absolute operation to highlight

1470

these non-trivial parts in Ac, following by a Gaussian kernel
convolution layer to enhance the regional homogeneity of
the features. The variance of the Gaussian kernel can further
be used to control the salient region‚Äôs proportion in content
image. We obtain our attention map ÀÜAc after normalizing
into the range [0, 1]. Figure 3 shows the visualization image
of the intermediate results. We notice that the attention map
can enlarge the attending inÔ¨Çuence of saliency regions while
maintaining the correlations among distant regions.

In addition to the K swapped features ÀÜf k

cs obtained from
the multi-scale style swap, we introduce the whitened con-
tent feature ÀÜfc as another entry to character the most signiÔ¨Å-
cant regions, which is known as the Ô¨Åne-grained stroke ÀÜf 0
cs.
Therefore, we have in total of K+1 features for multi-stroke
fusion.

To integrate arbitrary strokes in a scalable framework,
we propose a Ô¨Çexible fusion strategy by Ô¨Årst dividing the at-
tention map ÀÜAc into multiple clusters according to the stroke
number provided. We apply k-means method to cluster our
attention map, the goal is to iteratively Ô¨Ånd K+1 intensity
centers, minimizing the Euclidean distance between center
and elements among each clusters.

arg min G =

K

X

k=0

X
ÀÜai

c‚ààSk

||ÀÜai

c ‚àí mk||2 ,

(10)

where K+1 clusters are generated, and mk ‚àà [0, 1] denotes
the mean intensity value of all the attention points ÀÜai
c in
cluster Sk.

The multi-stroke fusion can then be formulated as inte-
grating the content feature with multiple swapped features
under the guidance of attention map.

ÀÜfcs =

K

X

k=0

ÀÜAk
c

ÀÜf k
cs ,

(11)

where ÀÜAk
c is the weight map assigned to the kth stroke size,
and k = 0 denotes the Ô¨Åne-grained stroke. The weight map
is computed by a softmax function:

ÀÜAk

c =

eŒ≥¬∑(1‚àíDk)
i=0 eŒ≥¬∑(1‚àíDi)

PK

.

(12)

We deÔ¨Åne Dk = | ÀÜAc‚àímk| to measure the absolute distance
with regard to the center mk, thus 1 ‚àí Dk can be used to
indicate how much extent each stroke size contributes to
synthesis the feature. The smoothing factor Œ≥ is used to
control the smoothing degree for fusion.

Before feeding into the decoder to generate the stylized
result, we derive fcs by performing coloring transform with
the syncretic feature ÀÜfcs to match feature statistics to the
style feature fs following [13].

4. Experiments

4.1. Implementation Details

We train our self-attention autoencoder for reconstruc-
tion using MS-COCO dataset [15], which contains roughly
80,000 training examples. We preserve the aspect ratio
of image and rescale the smaller dimension to 512 pixels,
and then randomly crop to 256 √ó 256 pixels. Our encoder
contains the Ô¨Årst few layers from VGG-19 model [22] pre-
trained on the ImageNet dataset [3]. The decoder is sym-
metric to the encoder structure. The Relu X 1 (X = 1, 2,
3, 4) in the encoder are used to compute the perceptual loss
and Œªcon, Œªp, Œªatt, Œªtv are set as 1, 10, 6, 10 to balance each
loss. We use three 1 √ó 1 convolutions for Œòh, Œòu, Œòg in
our self-attention module, and set ÀÜC = C for Œòh and C/2
for Œòu, Œòg. We train our network using the Adam opti-
mizer and a batch size of 8 for 10k iterations. Although our
method can handle arbitrary number of stroke fusions, we
select three stroke scenario as a default setting in the fol-
lowing experiments, including the Ô¨Åne-grained stroke size
and two coarse stroke sizes (K = 2) whose scale coefÔ¨Å-
cients Œ≤k are 0.5 and 1 respectively. We set the smoothing
factor Œ≥ as 50 to reveal discriminative patterns for different
stroke. To balance the stylization effects and the attention
consistency, we set the kernel size, mean and deviation in
our Attention Ô¨Ålter as 3, 6, 5 respectively.

To obtain abundant stylized information, it is advanta-
geous to match features across different levels in the VGG-
19 encoder to fully capture the characteristics of the style
as suggested in [13, 21]. We hence adopt a similar strategy
for our reconstruction process. We use skip connections
to perform style enhancement using adaptive instance nor-
malization [7], feeding with style features extracted from
Relu X 1 (X = 1, 2, 3) outputs and the reconstruction fea-
tures in corresponding deconvolution layers.

4.2. Qualitative Evaluation

Comparison With Prior Methods. We evaluate four
state-of-the-art methods for arbitrary style transfer: Style-
Swap [2], AdaIN [7], WCT [13] and Avatar-Net [21]. The
stylized results for various content/style pairs are shown in
Figure 4. Style-Swap simply relies on the patch similarity
between content and style feature, so as to strictly preserve
the content feature, which is validated in its results that only
low-level style patterns (e.g., colors) are transferred. AdaIN
presents an efÔ¨Åcient solution by directly adjusts the content
feature to match the mean and variance of the style feature.
But it usually brings similar texture patterns for all the styl-
ized images (e.g., the crack pattern in all stylized results)
due to the style-dependent training. WCT holistically ad-
justs the feature covariance of content feature to match that
of style feature, which inevitably brings unseen information
and unconstrained patterns, for example the missing circu-

1471

Content & Style

Style-Swap

AdaIN

WCT

Avatar-Net

Attention Map

Ours

Figure 4. Results from different ASPM style transfer methods. We evaluate various content images including portraits, animals, landscapes
with distinctive styles. The results of compared methods are obtained by running their codes with default conÔ¨Ågurations.

lar patterns in the 6th row and the unexpected textures in the
5th row. Avatar-Net shrinks the domain gap between con-
tent and style features and enhances propagation for feature
alignment. Although concrete style patterns are reÔ¨Çected,
it still cannot handle attention-aware feature adaption and
manifest distortion from semantically perception, for exam-
ple the eyes on the Ô¨Årst row and the farmer on the last row.

By contrast, our method can produce visually plausible
stylized results against the previous methods. The atten-
tion map enables the seamlessly synthesis among multiple
stroke sizes, while demonstrating superior spatial consis-
tency of visual attention between content image and stylized
image. In the last column of Figure 4, the salient regions
in content images such as eyes, candles, house and farmer
still maintain the focus in the stylized image. This vali-
dates the effectiveness of the attention map in the 6th col-
umn, where salient regions are mainly attributes to the Ô¨Åne-
grained stroke size. In addition, the attention map exhibits
similarity measurement between distant regions, which al-
lows detailed features in distant portions of the image are
consistent with each other.

Content & Style

AAMS(-SA)

AAMS

Figure 5. Comparison results to present the effectiveness of atten-
tion guidance. Regions marked by bounding boxes are zoomed in
for a better visualization.

Method

AUC Judd ‚Üë

AAMS(-SA)

AAMS

0.479
0.484

SIM ‚Üë
0.677
0.744

NSS ‚Üë
3.627
4.172

CC ‚Üë
0.732
0.834

KL ‚Üì
0.458
0.396

Table 1. Quantitative measurements on saliency maps predicted by
SalGAN [18]. The attention consistency is dramatically improved
with our method for all the evaluation metrics [1].

Ablation Studies. We discuss in Section 3 about the contri-
butions of the proposed modules. The self-attention module
is responsible for capturing attention characteristics of con-
tent image, such that the multi-scale style swap module and
the multi-stroke module can work together to integrate mul-
tiple stroke patterns. Several evaluations are performed to
verify the effectiveness of the coupling framework.

1472

Small

Large

Figure 6. Stylized result via different stroke sizes.

Two strokes

Three strokes

Four strokes

Attention map

ùõæ = 0

ùõæ = 5

ùõæ = 50

Figure 7. Left: fusion strategy with varying number of stroke sizes, Right: level of detail control via regulating the smoothing factor Œ≥.

We Ô¨Årst train an autoencoder by removing the self-
attention module. Since no guidance from the attention
map, we apply an average fusion strategy in the multi-
stroke fusion module during the testing phase. We name
this method as AAMS(-SA). Figure 5 shows the compari-
son with our method AAMS. Our stylized result with self-
attention module demonstrates dramatical improvement on
visual effect compared with AAMS(-SA), mainly in two
aspects: 1) Our attention-aware method emphasizes the
salient regions by painting with Ô¨Åne-grained stroke. 2)
The multi-stroke fusion allows abundant integration among
stroke patterns and presents discriminative style patterns lo-
cally without sacriÔ¨Åcing the holistic perception.

Apart from the cooperation between self-attention and
multi-stroke fusion module, the multi-scale style swap also
form a compact afÔ¨Åliation with the fusion module. Without
the multi-scale style swap module, the style transfer will be
restricted to single stroke pattern. We present the Ô¨Ånal styl-
ized results in Figure 6 with different stroke patterns. The
stroke size is controlled by changing the scaling coefÔ¨Åcient
Œ≤ in eq. (8). From left to right, the larger the stroke size, the
coarser stylized pattern emerges. When multiple stroke pat-
terns are generated together, the multi-stroke fusion module
can integrate them into one stylized image.

4.3. Quantitative Evaluation

User Studies. As artistic style transfer is a highly subjec-
tive task, we resort to user studies to better evaluate the per-
formance of the proposed method. Since Style-Swap [2]
only transfers low-level information, resulting in insufÔ¨Å-
cient stylization effects. We compare the proposed method
to the other three competing methods,
i.e., AdaIN [7],
WCT [13] and Avatar-Net [21]. We use 10 content im-
ages and 15 style images collected from the aforementioned
methods and synthesize 150 images for each method, from
which we show 20 randomly chosen content and style com-
binations to each subject.

Figure 8. User study results.

We conduct two user studies on the results in terms of
the stylization effects and faithfulness to content character-
istics. In the Ô¨Årst study, we ask the participants to select
which stylized image better transfers both color and tex-
ture patterns of style image to content image. In the second
study, we ask the participants to select which stylized image
better preserves the content characters with less distorted ar-
tifacts. In each question, we display the content/style pair
and randomly ordered stylized images by 4 compared meth-
ods and ask the participants to vote the best one according
to the questions. We Ô¨Ånally collect totally 600 votes from
30 subjects and demonstrate the preference results in Fig-
ure 8. The studies show that our method receives most votes
for both stylization and attention consistency. The better
preservation for visual attention enables perceptual promo-
tion for stylization.
Consistency Evaluation. To further evaluate the effec-
tiveness on preserving the attention consistency of our
method, we propose to adopt saliency metrics [1] to mea-
sure the saliency similarity between content and stylized
image pairs. These metrics are widely used to evaluate a
saliency model‚Äôs ability to predict ground truth human Ô¨Åxa-

1473

AdaINWCTAvatar-NetOurs0.00.10.20.30.4PreferenceStylization effectsFaithful to contentMethod

AdaIN
WCT

Style-Swap
Avatar-Net

Ours (2-stroke)
Ours (3-stroke)
Ours (4-stroke)
Ours (8-stroke)

Execution Time (sec)
512√ó512
256√ó256

0.09
0.92
1.96
0.78
0.74
0.80
0.92
0.94

0.17
1.05
5.77
0.86
0.81
0.94
1.15
1.18

Stroke Size 1

Stroke Size 2

Stroke Size 3

Table 2. Run time performance. We show runtime test of different
stroke numbers with our method and other feedforward methods.

Content & Style

Attention Map

Multi-stroke result

Figure 9. Our method enables automatic spatial stroke size control.

tions. We generate the saliency maps of stylized images and
their corresponding content images using SALGAN [18], a
state-of-the-art saliency prediction method. We then em-
ploy Ô¨Åve metrics to evaluate the degree of visual attention
consistency for 400 content/stylized image pairs. Compari-
son results between the proposed method and AAMS(-SA)
are shown in Table 1. With our AAMS framework, the
attention consistency is dramatically improved for all the
evaluation metrics. The results further verify the ability in
maintaining saliency for style transfer.
Speed Analysis. We show the run time performance of our
method and prior feed-forward methods in Table 2. Re-
sults are obtained with a 12G Tesla M40 GPU and aver-
aged over 400 transfers. Among the patch based methods
(Style-Swap, Avatar-Net), our method achieves comparable
speed even with multi-scale feature processing. Given three
strokes, it takes averagely 0.80 and 0.94 seconds to transfer
images with size 256 √ó 256 and 512 √ó 512 respectively.
Since the running time increases with stroke numbers in a
controllable trend, the tradeoff between efÔ¨Åciency and de-
tails diversity should be considered.

4.4. Runtime Control

Given the learnt attention map, our method is Ô¨Çexible to

provide different controls on the multi-stroke stylization.
Multi-stroke Fusion Control. One of the advantage to-
wards the prior methods is that our method can effec-
tively integrate multiple stroke patterns with different con-
trol strategies, including the number of stroke sizes and
level of detail control. As discussed in the previous section,
the different scale of high-level style feature will lead to
different statistics after a style swap process with the same
content feature. Given arbitrary number of stroke sizes, our
method allows Ô¨Çexible fusion among these strokes. The left
part of Figure 7 demonstrates three fusion results with dif-
ferent number of stroke sizes. Note that by integrating with
more stroke sizes, the stylized result presents more vary-
ing patterns with different stroke boundaries, the reason for
this is that our clustering algorithm produces different at-
tention distributions for different number of clusters, which
results in varying weight maps. The right part of Figure

7 shows our ability in regulating level of detail control for
four-stroke fusion. According to eq. (12), the smoothing
factor Œ≥ determines the weight distribution for all stroke
sizes. As shown in Figure 7, the larger it is, the more dis-
criminative for each stroke within corresponding regions.
Automatic Spatial Stroke Size Control. Spatial stroke
size control refers to properly utilizing strokes of differ-
ent sizes to render regions with different levels of detail
in an image. The gist is that for a visually plausible styl-
ized artwork, we usually hope to use stroke of small size for
salient regions (e.g., objects, humans), while large size for
less salient ones (e.g., sky, grassland). To this end, pre-
vious method [8] generally employs several hand-crafted
masks and then stylize corresponding regions separately.
Our method, however, empowers spatial control in an auto-
matic way due to the self-attention mechanism. As shown
in Figure 9, three stroke sizes are adopted to render re-
gions of different saliency, i.e., the Ô¨Åne stroke patterns on
the farmer, the middle stroke patterns on the mountain and
coarse stroke patterns on the grass. In particular, these re-
gions are partitioned and integrated automatically under the
guidance of content attention map during our multi-stroke
fusion procedure, thus providing automatic solution for spa-
tial control (which refers to transferring each region with
different styles in the content image) instead of mask con-
trolling methods [6, 13].

5. Conclusion

In this paper, we propose an attention-aware multi-stroke
style transfer model for arbitrary styles. We employ self-
attention as a residual to obtain the attention map, and then
introduce multi-scale style swap and a Ô¨Çexible stroke fu-
sion strategy to adaptively integrate multiple style patterns
into one stylized image. Experimental results demonstrate
the effectiveness of our method in generating favorable re-
sults in terms of stylization effects and visual consistency
with content image. As a future direction, one may further
explore the relation between the stroke assignment and aes-
thetic factors for enhanced stylization.
Acknowledgements. This work was supported by the Nat-
ural Science Foundation of China (61725204).

1474

References

[1] Zoya Bylinskii, Tilke Judd, Aude Oliva, Antonio Torralba,
and Fr¬¥edo Durand. What do different evaluation metrics tell
us about saliency models? TPAMI, 2018.

[2] Tian Qi Chen and Mark Schmidt. Fast patch-based style
transfer of arbitrary style. arXiv preprint arXiv:1612.04337,
2016.

[3] Jia Deng, Wei Dong, Richard Socher, Li-Jia Li, Kai Li,
and Li Fei-Fei. Imagenet: A large-scale hierarchical image
database. In CVPR, 2009.

[4] Leon Gatys, Alexander S Ecker, and Matthias Bethge. Tex-
ture synthesis using convolutional neural networks. In NIPS,
2015.

[5] Leon A Gatys, Alexander S Ecker, and Matthias Bethge. Im-
In

age style transfer using convolutional neural networks.
CVPR, 2016.

[6] Leon A Gatys, Alexander S Ecker, Matthias Bethge, Aaron
Hertzmann, and Eli Shechtman. Controlling perceptual fac-
tors in neural style transfer. In CVPR, 2017.

[7] Xun Huang and Serge J Belongie. Arbitrary style transfer
in real-time with adaptive instance normalization. In ICCV,
2017.

[8] Yongcheng Jing, Yang Liu, Yezhou Yang, Zunlei Feng,
Yizhou Yu, Dacheng Tao, and Mingli Song. Stroke con-
trollable fast style transfer with adaptive receptive Ô¨Åelds. In
ECCV, 2018.

[9] Yongcheng Jing, Yezhou Yang, Zunlei Feng, Jingwen Ye,
Yizhou Yu, and Mingli Song. Neural style transfer: A review.
arXiv preprint arXiv:1705.04058, 2017.

[10] Justin Johnson, Alexandre Alahi, and Li Fei-Fei. Perceptual
In

losses for real-time style transfer and super-resolution.
ECCV, 2016.

[11] Hugo Larochelle and Geoffrey E Hinton. Learning to com-
bine foveal glimpses with a third-order boltzmann machine.
In NIPS, 2010.

[12] Chuan Li and Michael Wand. Precomputed real-time texture
synthesis with markovian generative adversarial networks. In
ECCV, 2016.

[13] Yijun Li, Chen Fang, Jimei Yang, Zhaowen Wang, Xin Lu,
and Ming-Hsuan Yang. Universal style transfer via feature
transforms. In NIPS, 2017.

[14] Yanghao Li, Naiyan Wang,

Jiaying Liu, and Xiaodi
Hou. Demystifying neural style transfer. arXiv preprint
arXiv:1701.01036, 2017.

[15] Tsung-Yi Lin, Michael Maire, Serge Belongie, James Hays,
Pietro Perona, Deva Ramanan, Piotr Doll¬¥ar, and C Lawrence
Zitnick. Microsoft coco: Common objects in context.
In
ECCV, 2014.

[16] Zhouhan Lin, Minwei Feng, Cicero Nogueira Dos Santos,
Mo Yu, Bing Xiang, Bowen Zhou, and Yoshua Bengio. A
structured self-attentive sentence embedding. In ICLR, 2017.

[17] Volodymyr Mnih, Nicolas Heess, Alex Graves, et al. Recur-

rent models of visual attention. In NIPS, 2014.

[18] Junting Pan, Cristian Canton Ferrer, Kevin McGuinness,
Noel E O‚ÄôConnor, Jordi Torres, Elisa Sayrol, and Xavier

Giro-i Nieto. Salgan: Visual saliency prediction with genera-
tive adversarial networks. arXiv preprint arXiv:1701.01081,
2017.

[19] Eric Risser, Pierre Wilmot, and Connelly Barnes. Stable and
controllable neural texture synthesis and style transfer using
histogram losses. arXiv preprint arXiv:1701.08893, 2017.

[20] Peter Shaw, Jakob Uszkoreit, and Ashish Vaswani. Self-
arXiv

attention with relative position representations.
preprint arXiv:1803.02155, 2018.

[21] Lu Sheng, Ziyi Lin, Jing Shao, and Xiaogang Wang. Avatar-
net: Multi-scale zero-shot style transfer by feature decora-
tion. In CVPR, 2018.

[22] Karen Simonyan and Andrew Zisserman. Very deep convo-
lutional networks for large-scale image recognition. In ICLR,
2015.

[23] Dmitry Ulyanov, Vadim Lebedev, Andrea Vedaldi, and Vic-
tor S Lempitsky. Texture networks: Feed-forward synthesis
of textures and stylized images. In ICML, 2016.

[24] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszko-
reit, Llion Jones, Aidan N Gomez, ≈Åukasz Kaiser, and Illia
Polosukhin. Attention is all you need. In NIPS, 2017.

[25] Xin Wang, Geoffrey Oxholm, Da Zhang, and Yuan-Fang
Wang. Multimodal transfer: A hierarchical deep convolu-
tional neural network for fast artistic style transfer. In CVPR,
2017.

[26] Tianjun Xiao, Yichong Xu, Kuiyuan Yang, Jiaxing Zhang,
Yuxin Peng, and Zheng Zhang. The application of two-level
attention models in deep convolutional neural network for
Ô¨Åne-grained image classiÔ¨Åcation. In CVPR, 2015.

[27] Huijuan Xu and Kate Saenko. Ask, attend and answer: Ex-
ploring question-guided spatial attention for visual question
answering. In ECCV, 2016.

[28] Kelvin Xu, Jimmy Ba, Ryan Kiros, Kyunghyun Cho, Aaron
Courville, Ruslan Salakhudinov, Rich Zemel, and Yoshua
Bengio. Show, attend and tell: Neural image caption gen-
eration with visual attention. In ICML, 2015.

[29] Zichao Yang, Xiaodong He, Jianfeng Gao, Li Deng, and
Alex Smola. Stacked attention networks for image question
answering. In CVPR, 2016.

[30] Quanzeng You, Hailin Jin, Zhaowen Wang, Chen Fang, and
In

Image captioning with semantic attention.

Jiebo Luo.
CVPR, 2016.

[31] Han Zhang, Ian Goodfellow, Dimitris Metaxas, and Augus-
tus Odena. Self-attention generative adversarial networks.
arXiv preprint arXiv:1805.08318, 2018.

[32] Bolei Zhou, Aditya Khosla, Agata Lapedriza, Aude Oliva,
and Antonio Torralba. Learning deep features for discrimi-
native localization. In CVPR, 2016.

[33] Song-Chun Zhu, Cheng-En Guo, Yizhou Wang, and Zijian
Xu. What are textons? International Journal of Computer
Vision, 2005.

1475

